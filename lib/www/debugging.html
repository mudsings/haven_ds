<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="content-type">
  <title>Dead Souls debugging</title>
</head>
<body>
<span style="font-weight: bold;">Debugging in Dead Souls</span><br>
<br>
So you've made some cool stuff but darn it, it doesn't work. There are
various<br>
tools available in the Dead Souls lib to hunt down the source of the
problem:<br>
<br>
<br>
<big
 style="text-decoration: underline; font-family: Times New Roman,Times,serif;"><big><big>elog</big></big></big><br>
<pre><big>If the file is somewhere in your home directory, just type: <span
 style="font-weight: bold;">elog</span> <br><br>This will provide you a listing of the last few lines of your personal<br>error log. Warning lines tell you about code that works but should<br>be fixed in some way. Lines that don't contain the word "Warning" are<br>error lines: they indicate something about your code that prevents<br>it from working. For example:<br><br></big></pre>
<hr style="width: 100%; height: 2px;">&gt; <span
 style="font-weight: bold;">update sample_room</span><br>
<pre><big><span style="font-style: italic;"></span><span
 style="font-style: italic;">---<br>*Error in loading object '/realms/cratylus/area/room/sample_room'<br>Object: /secure/cmds/creators/update at line 148<br><br>'&lt;function&gt;' at /secure/save/creators/c/cratylus (&lt;function&gt;) at /:0<br>'cmdAll' at /secure/save/creators/c/cratylus (/lib/command.c) at line 84<br>'cmd' at /secure/cmds/creators/update at line 109<br>'eventUpdate' at /secure/cmds/creators/update at line 148<br>'CATCH' at /secure/cmds/creators/update at line 148<br>Trace written to /log/catch<br>/realms/cratylus/area/room/sample_room: Error in update<br>*Error in loading object '/realms/cratylus/area/room/sample_room'<br></span></big></pre>
<hr style="width: 100%; height: 2px;">
<pre><big><span style="font-style: italic;"><br></span><br>	This output lets you know something is wrong, but<br>isn't very specific as to exactly what. If you look at your error<br>log, you probably will see something more detailed and helpful:<br><br><br></big></pre>
<hr style="width: 100%; height: 2px;">&gt; <span
 style="font-weight: bold;">elog</span><br>
<pre><big><span style="font-style: italic;">/log/errors/cratylus:</span><br
 style="font-style: italic;"><br style="font-style: italic;"><span
 style="font-style: italic;"></span><span style="font-style: italic;">/realms/cratylus/area/room/sample_room.c line 10: Undefined variable 'Sample'<br>/realms/cratylus/area/room/sample_room.c line 10: parse error<br></span></big></pre>
<hr style="width: 100%; height: 2px;">
<pre><big><span style="font-style: italic;"><br></span><br>	Now you can see that the error is my syntax on<br>line 10. I would then use ed to examine the code, and specifically lines 9<br>through 11. It turns out that I forgot to put quotes around the room name, <br>so the parser tried to use it as a variable, which, of course, it couldn't.<br><br>	If the file in question is in /secure, you'd type <span
 style="font-weight: bold;">elog secure</span> , or if<br>it's in /cmds, <span
 style="font-weight: bold;">elog cmds</span> , and so on.<br><span
 style="font-weight: bold;"><br>	</span></big><br><big><span
 style="font-weight: bold;"></span><big
 style="font-weight: bold; text-decoration: underline; font-family: Times New Roman,Times,serif;"><big><big>dbxwhere</big></big></big></big><big><big
 style="font-weight: bold; text-decoration: underline; font-family: Times New Roman,Times,serif;"><big><big> &amp; dbxframe</big></big></big><span
 style="font-weight: bold;"><br></span></big><big><span
 style="font-weight: bold;"></span></big><big><span
 style="font-weight: bold;"><br>	</span>Two<span
 style="font-weight: bold;"> </span>helpful debugging commands are dbxframe and dbxwhere. Let's<br>take a look at my broken sample_room.c file. We'll start with dbxwhere,<br>which lists for us the chain of events that led to the error. The<br>indivudual steps are called frames.<br><br>&gt; <span
 style="font-weight: bold;">dbxwhere</span><br>*Error in loading object '/realms/cratylus/area/room/sample_room'<br>Object: /secure/cmds/creators/update at line 148<br><br>#0: '&lt;function&gt;' at /secure/save/creators/c/cratylus (&lt;function&gt;) at /:0<br>#1: 'cmdAll' at /secure/save/creators/c/cratylus (/lib/command.c) at line 84<br>#2: 'cmd' at /secure/cmds/creators/update at line 109<br>#3: 'eventUpdate' at /secure/cmds/creators/update at line 148<br>#4: 'CATCH' at /secure/cmds/creators/update at line 148<br></big></pre>
<br>
The output is similar to the update error we saw above, but in
ennumerating the steps, <span style="font-weight: bold;">dbxwhere</span><br>
lets us use <span style="font-weight: bold;">dbxframe</span> to get
tighter detail on a given error frame:<br>
<br>
&gt; <span style="font-weight: bold;">dbxframe 4</span><br>
<span style="font-family: monospace;">------</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
/secure/cmds/creators/update.c:148 - CATCH(0)</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
----------------------------------------------------------------</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
if( args == base_name(this_object()) ) {</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
this_player()-&gt;eventPrint("Cannot reload update after destruct.\n"</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"It will be reloaded at next reference.");</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
return 0;</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
}</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; =&gt;&nbsp;
tmp = catch(call_other(args, "???"));</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
if( !tmp ) {</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
if(identify(flags ^ U_AUTOMATED) ==</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
"8")this_player()-&gt;eventPrint(args + ": Ok");</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
return 1;</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
} else this_player()-&gt;eventPrint(args + ": Error in update\n" + tmp);</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
return 0;</span><br>
<br>
<br>
&nbsp;&nbsp;&nbsp; We're now looking at the error context for error
frame 4. The output of the command shows<br>
us part of the file that was performing the evaluation when the error
occurred, and even<br>
points out the offending line using a text arrow: <span
 style="font-family: monospace;"> =&gt;</span><br>
<br>
&nbsp;&nbsp;&nbsp; In this particular case, the information is not that
helpful. We are being told that<br>
the error occurred while we were using the update command, and it
failed at the line<br>
where update does its thing. Duh, we knew that. The <span
 style="font-weight: bold;">elog</span> command was much more helpful.<br>
<br>
&nbsp;&nbsp;&nbsp; Where this kind of tracing comes in handy is when
you enounter a runtime error<br>
when you're not updating a file. For example, if I tried to enter that
room, rather than<br>
update it, I'd get a big pukey error message and not know why. If you
run into an<br>
unexpected error, <span style="font-weight: bold;">dbxwhere</span>
will help you pinpoint it if <span style="font-weight: bold;">elog</span>
doesn't provide useful information,<br>
and <span style="font-weight: bold;">dbxframe</span> will help detail
the source of the problem.<br>
<br>
<pre><big><big><big
 style="text-decoration: underline; font-family: Times New Roman,Times,serif;"><big><big>tail</big></big></big></big></big></pre>
<br>
&nbsp;&nbsp;&nbsp; This is a version of the unix tail command. It
displays the last few lines of a file. <br>
This command is important for examining crucial log files:<br>
<br>
<span style="font-weight: bold;">tail /log/catch</span><big><br>
<small style="font-weight: bold;">tail /log/runtime<br>
</small></big><big><small style="font-weight: bold;">tail
/log/player_errors<br>
<br>
<br>
</small></big><big
 style="text-decoration: underline; font-family: Times New Roman,Times,serif;"><big><big>bk
&amp; restore<br>
<br>
</big></big></big>These commands aren't so much for debugging as they
are for safe coding. Before you<br>
edit a file, it is a very good idea to back it up first. The <span
 style="font-weight: bold;">bk</span> command lets you<br>
quickly and conveniently back up a file before you edit it. When I
typed:<br>
<br>
<span style="font-weight: bold;">bk sample_room</span><br>
<br>
A file with a unique identifying number was created in my bak/
directory. If I<br>
were to type it again, then sample_room.c would get copied again to
bak/, with<br>
a new unique number added to the name.<br>
<br>
&nbsp;&nbsp;&nbsp; The number is basically the number of seconds
elapsed since January 1, 1970.<br>
Adding this number, we can keep track of which backed up version of a
file<br>
is most recent by looking at the name.<br>
<br>
&nbsp;&nbsp;&nbsp; Suppose I edited a file called sample_npc.c. I use
bk to back it up, make some changes,<br>
then use bk again, make some more changes, but now it won't update. I
don't<br>
feel like debugging, I just need this file working again, so I want to
restore from<br>
backup. The sequence of commands would look something like this:<br>
<br>
<span style="font-weight: bold;">ed sample_npc.c</span><br
 style="font-weight: bold;">
<span style="font-weight: bold;">bk sample_npc</span><br
 style="font-weight: bold;">
<span style="font-weight: bold;">ed sample_npc.c</span><br
 style="font-weight: bold;">
<span style="font-weight: bold;">update sample_npc.c</span><br>
<span style="color: rgb(204, 0, 0);">&lt;error occurs here&gt;</span><br>
<span style="font-weight: bold;">restore sample_npc</span><br>
<br>
&nbsp;&nbsp;&nbsp; The reason identifying numbers are used is that you
can also choose to<br>
restore the second-to-last backup version of a file, and other previous<br>
versions.<br>
&nbsp;&nbsp;&nbsp; The very last backup version is effectively version
0, so it's not<br>
necessary to specify a number. If I wanted to restore the version I
backed<br>
up before that one, I would type something like this:<br>
<br>
<span style="font-weight: bold;">restore sample_npc 1</span><br>
<br>
&nbsp;&nbsp;&nbsp; And if I wanted the version before that one, I'd
specify 2 instead of 1, <br>
and so on.<br>
<br>
&nbsp;&nbsp;&nbsp; Please note that this is an intentionally simple
system. There are<br>
no menus, no version branches, or diff tracking. The reason for this is<br>
that it is not a <span style="font-style: italic;">versioning</span>
system. It is a <span style="font-style: italic;">backup</span>
system. It is a convenient<br>
tool to back out of screwups, not a development tool to test file
versions.<br>
<big><small style="font-weight: bold;"><br>
<br>
</small></big><a href="index.html">Dead Souls Homepage</a><br>
<big><small style="font-weight: bold;"><br>
<br>
</small></big>
</body>
</html>
