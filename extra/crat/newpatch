export NEWLIB=$2
export OLDLIB=$1

#vi /root/updaterr$OLD\_r$NEW.c

cd /
date

mkdir /tmp/foo
rm -rf /tmp/foo/*

cd /tmp/foo

unzip -qd $OLDLIB /misc/data/mud/deadsouls/$OLDLIB.zip
unzip -qd $NEWLIB /misc/data/mud/deadsouls/$NEWLIB.zip

mv $OLDLIB/*/* $OLDLIB/

mv $NEWLIB/*/* $NEWLIB/


#\rm -f $OLDLIB/lib/secure/include/config.h
#\rm -f $NEWLIB/lib/secure/include/config.h

\rm -r $NEWLIB/lib/core  $OLDLIB/lib/core
\rm -r $NEWLIB/lib/secure/sefun/native_version.c  $OLDLIB/lib/secure/sefun/native_version.c
#\rm -r $NEWLIB/lib/secure/sefun/mud_info.c  $OLDLIB/lib/secure/sefun/mud_info.c

\cp -f $NEWLIB/lib/secure/lib/connect.real $NEWLIB/lib/secure/lib/connect.c
#\rm -r $NEWLIB/lib/secure/lib/connect.c $OLDLIB/lib/secure/lib/connect.c

\cp -f $NEWLIB/lib/secure/daemon/update.patch $NEWLIB/lib/secure/daemon/update.c
\cp -f $OLDLIB/lib/secure/daemon/update.patch $OLDLIB/lib/secure/daemon/update.c

echo "foo" > $NEWLIB/lib/secure/upgrades/files/0^0tmp0^0foo.txt
mkdir $OLDLIB/lib/www/cgi
mkdir $OLDLIB/lib/lib/daemons
mkdir $OLDLIB/lib/verbs/builders
mkdir $OLDLIB/lib/cmds/builders
mkdir $OLDLIB/lib/secure/cmds/builders
mkdir $OLDLIB/lib/lib/daemons
mkdir $OLDLIB/lib/lib/daemons/include

gdiff -rq $OLDLIB/lib $NEWLIB/lib > diff.txt

perl -pi -e s/"\:\ "/"\/"/g diff.txt

cd $NEWLIB/

find ./lib -type f  -exec /contrib/enters {} \;
rm lib/secure/include/config.h
rm lib/secure/cfg/mudos.cfg
rm lib/secure/cfg/groups.cfg
for i in `find ./lib`;do rmdir $i;done
for i in `find ./lib`;do rmdir $i;done
for i in `find ./lib`;do rmdir $i;done
for i in `find ./lib`;do rmdir $i;done
for i in `find ./lib`;do rmdir $i;done
for i in `find ./lib`;do rmdir $i;done
for i in `find ./lib`;do rmdir $i;done
for i in `find ./lib`;do rmdir $i;done
for i in `find ./lib`;do rmdir $i;done
for i in `find ./lib`;do rmdir $i;done
for i in `find ./lib`;do rmdir $i;done
for i in `find ./lib`;do rmdir $i;done
for i in `find ./lib`;do rmdir $i;done
for i in `find ./lib`;do rmdir $i;done
for i in `find ./lib`;do rmdir $i;done
for i in `find ./lib`;do rmdir $i;done
tar cfp ../patch.tar lib
cd ..
mv $NEWLIB fukt
unzip -qd $NEWLIB /export/home/$HOME/mud/$NEWLIB.zip
mv $NEWLIB/*/* $NEWLIB/
cd $OLDLIB
tar xfp ../patch.tar
cd ..
gdiff -rq $OLDLIB/ $NEWLIB/ > diff2.txt
echo "Anything after this is an imperfection except for the connect.c"
cat diff2.txt
\mv -f lib lib.foo
tar xfp patch.tar
find ./lib |sort -dr > lib.txt
\mv -f patch patch.foo
mkdir patch
#\cp -f ~/updaterr$OLD\_r$NEW.c lib/secure/daemon/update.c
\cp -f ~/update.blank lib/secure/daemon/
\cp -f ~/instructions\_$OLD\_$NEW.txt patch/instructions.txt
chown -R 513:513 lib
chmod -R 775 lib
mv lib patch/
date
cat diff2.txt
cd patch/lib
find ./ |grep -v "\.html"|grep -v "\.gif" |grep -v "\.o" > upgrades.txt
find ./ |grep  "\.orig" >> upgrades.txt
perl -pi -e s/"\.\/lib"/"\/lib"/g upgrades.txt
perl -pi -e s/"\.\/"/"\/"/g upgrades.txt
mv upgrades.txt ../

